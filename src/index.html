<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Insight Nexus</title>
    <!-- Copyright (c) 2024 Investigating Project - Licensed under the MIT License -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600&display=swap" rel="stylesheet">

</head>

<body>
    <div id="toolbar">
        <div class="menu">
            <button onclick="toggleDropdown('file-dropdown')">File</button>
            <div id="file-dropdown" class="dropdown">
                <button onclick="newProject()">New Project</button>
                <button onclick="event.stopPropagation(); toggleDropdown('load-dropdown')">Load</button>
                <div id="load-dropdown" class="sub-dropdown">
                    <select id="file-picker"></select>
                    <button onclick="confirmLoad()">Load Selected</button>
                </div>
                <button onclick="event.stopPropagation(); toggleDropdown('save-dropdown')">Save</button>
                <div id="save-dropdown" class="sub-dropdown">
                    <select id="save-file-picker"></select>
                    <button onclick="saveToCurrentFile()">Save to Current</button>
                    <button onclick="saveAsNewFile()">New File</button>
                </div>
            </div>
        </div>
        <div class="menu">
            <button onclick="toggleDropdown('selection-dropdown')">Tools</button>
            <div id="selection-dropdown" class="dropdown">
                <button onclick="handleContextAction('connect')">Connect Nodes</button>
                <button id="group-nodes-btn" onclick="toggleGroupMode()">Group Nodes</button>
                <button id="transform-toggle-btn" onclick="handleTransformAction()">Upload Transform</button>
            </div>
        </div>
        <div class="menu">
            <button onclick="toggleDropdown('edit-dropdown')">Edit</button>
            <div id="edit-dropdown" class="dropdown">
                <button onclick="ur.undo()">Undo</button>
                <button onclick="ur.redo()">Redo</button>
            </div>
        </div>
    <div class="menu">
        <button onclick="toggleDropdown('help-dropdown')">Help</button>
        <div id="help-dropdown" class="dropdown">
            <button onclick="tutorialSystem.restartTutorial()">Restart Tutorial</button>
            <button onclick="openCustomTransformGuide()">Custom Transform User Guide</button>
            <button onclick="openSupportEmail()">Need Support?</button>
        </div>
    </div>
    <div class="menu">
        <button onclick="toggleDropdown('settings-dropdown')">Settings</button>
        <div id="settings-dropdown" class="dropdown">
            <button id="node-properties-collapse-toggle" onclick="toggleNodePropertiesCollapse()">
                <span id="node-properties-collapse-indicator">‚òê</span> Node Properties Always Collapsed: <span id="node-properties-collapse-status">OFF</span>
            </button>
        </div>
    </div>
    <div class="menu">
        <button onclick="openFeedbackEmail()">Feedback</button>
    </div>
    <div class="menu dark-mode-menu">
        <button id="dark-mode-toggle" onclick="toggleDarkMode()">
            <span class="icon">üåô</span>
        </button>
    </div>
</div>

    <div id="cy"></div>

    <!-- Notes Panel -->
    <div id="notes-panel">
        <div id="notes-content">
            <div class="notes-header">
                <h3 class="notes-title">Investigation Notes</h3>
                <button id="notes-close-btn" class="notes-close-btn" onclick="toggleNotesPanel()">
                    <span class="close-icon">√ó</span>
                </button>
            </div>
            <div class="notes-body">
                <textarea id="global-notes-textarea" placeholder="Write your investigation notes here...&#10;&#10;‚Ä¢ Use this space to document your findings&#10;‚Ä¢ Track important observations&#10;‚Ä¢ Record hypotheses and conclusions&#10;‚Ä¢ Notes are automatically saved with your project" class="global-notes-textarea"></textarea>
                <div class="notes-footer">
                    <div class="notes-stats">
                        <span id="notes-word-count">0 words</span>
                        <span id="notes-char-count">0 characters</span>
                    </div>
                    <div class="notes-actions">
                        <button id="clear-notes-btn" class="notes-action-btn secondary">Clear</button>
                        <button id="export-notes-btn" class="notes-action-btn">Export</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Toggle Button -->
    <button id="notes-toggle-btn" onclick="toggleNotesPanel()">
        <span class="notes-icon">üìù</span>
        <span class="notes-label">Notes</span>
    </button>

    <div id="node-properties-menu">
        <div id="properties-content">

            <p id="no-node-message">Please select a node to display its properties.</p>

            <div class="properties-section">
                <h3 class="section-header">Node Info</h3>
                <div id="node-details" class="node-info">
                    <label class="section-header field-row">Name: <input type="text" id="node-name"></label>
                    <label class="section-header">Type:
                        <select id="node-type-select">
                            <option value="default">Default</option>
                            <option value="person">Person</option>
                            <option value="event">Event</option>
                            <option value="organization">Organization</option>
                            <option value="username">Username</option>
                            <option value="custom">Custom</option>
                            <option value="address">Address</option>
                            <option value="domain">Domain</option>
                            <option value="ip">IP</option>
                            <option value="email">Email</option>
                            <option value="geo">Geo Data</option>
                            <option value="database">Database</option>
                        </select>
                    </label>
                </div>
            </div>

            <div class="properties-section">
                <h3 class="section-header">Images</h3>
                <div id="node-images" class="file-list"></div>
                <button id="upload-image-btn" class="section-button">Upload Image</button>
            </div>

            <div class="properties-section">
                <h3 class="section-header">Text Files</h3>
                <div id="node-texts" class="file-list"></div>
                <button id="upload-text-btn" class="section-button">Upload Text File</button>
            </div>

            <div class="properties-section">
                <h3 class="section-header">Notes</h3>
                <div id="node-notes" class="notes-container">
                    <textarea id="node-notes-textarea" placeholder="Write your notes here..." class="notes-textarea"></textarea>
                    <div class="notes-actions">
                        <button id="save-notes-btn" class="section-button">Save Notes</button>
                        <button id="clear-notes-btn" class="section-button secondary">Clear</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="properties-toggle-btn" onclick="togglePropertiesMenu()">
        <span class="toggle-icon">‚óÄ</span>
    </button>

    <div id="status-bar"></div>

    <div id="zoom-slider">
        <input type="range" min="0.1" max="2" step="0.01" value="1" id="zoom-control" />
        <span id="zoom-label">100%</span>
        <button id="reset-view-btn" onclick="resetToDefaultView()">Reset View</button>
    </div>



    <ul id="context-menu">
        <li class="submenu-trigger" onclick="toggleTransformSubmenu()">Transforms</li>
        <ul class="submenu" id="transform-submenu">
            <!-- Domain Analysis -->
            <li class="submenu-trigger" onclick="toggleSubmenu('domain-submenu')">Domain Analysis</li>
            <ul class="submenu" id="domain-submenu">
                <li onclick="handleContextAction('domain-to-ip')">Domain to IP</li>
                <li onclick="handleContextAction('domain-to-dns')">Domain to DNS</li>
                <li onclick="handleContextAction('domain-to-endpoint')">Domain to Endpoint</li>
                <li onclick="handleContextAction('domain-to-subdomain')">Domain to Subdomain</li>
                <li onclick="handleContextAction('whois')">Whois Information</li>
            </ul>
            
            <!-- Network Intelligence -->
            <li class="submenu-trigger" onclick="toggleSubmenu('network-submenu')">Network Intelligence</li>
            <ul class="submenu" id="network-submenu">
                <li onclick="handleContextAction('ip-to-netblock')">IP to Netblock</li>
                <li onclick="handleContextAction('ip-to-location')">IP to Location</li>
                <li onclick="handleContextAction('port-scan')">Port Scan</li>
            </ul>
            
            <!-- OSINT Tools -->
            <li class="submenu-trigger" onclick="toggleSubmenu('osint-submenu')">OSINT Tools</li>
            <ul class="submenu" id="osint-submenu">
                <li onclick="handleContextAction('sherlock')">Username Search</li>
            </ul>
            
            <!-- Web Analysis -->
            <li class="submenu-trigger" onclick="toggleSubmenu('web-submenu')">Web Analysis</li>
            <ul class="submenu" id="web-submenu">
                <li onclick="handleContextAction('website-to-domain')">Website to Domain</li>
                <li onclick="handleContextAction('website-screenshot')">Website Screenshot</li>
            </ul>
        </ul>
        <li onclick="handleContextAction('edit')">Edit</li>
        <li onclick="handleContextAction('delete')">Delete</li>
        <li onclick="handleContextAction('connect')">Create Connection</li>
        <li onclick="handleContextAction('group-nodes')">Group Nodes</li>
        <li onclick="handleContextAction('upload')">Upload File</li>
    </ul>

    <!-- Image Overlay -->
    <div id="image-overlay" class="image-overlay">
        <div class="image-overlay-content">
            <button class="image-overlay-close" onclick="closeImageOverlay()">√ó</button>
            <img id="overlay-image" src="" alt="Overlay Image">
        </div>
    </div>


    <script src="https://unpkg.com/cytoscape-node-html-label/cytoscape-node-html-label.js"></script>
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/cytoscape-edgehandles/cytoscape-edgehandles.min.js"></script>
    <script src="https://unpkg.com/cytoscape-undo-redo/cytoscape-undo-redo.js"></script>
    
    <!-- Fallback functions to prevent errors before modules load -->
    <script>
        // Temporary fallback functions
        window.togglePropertiesMenu = function() {
            console.log('togglePropertiesMenu called - waiting for module to load');
        };
        window.toggleDropdown = function() {
            console.log('toggleDropdown called - waiting for module to load');
        };
        window.handleContextAction = function() {
            console.log('handleContextAction called - waiting for module to load');
        };
        window.toggleDarkMode = function() {
            console.log('toggleDarkMode called - waiting for module to load');
        };
        window.toggleSubmenu = function() {
            console.log('toggleSubmenu called - waiting for module to load');
        };
        window.resetToDefaultView = function() {
            console.log('resetToDefaultView called - waiting for module to load');
        };
        window.toggleGroupMode = function() {
            console.log('toggleGroupMode called - waiting for module to load');
        };
        window.handleContextAction = function() {
            console.log('handleContextAction called - waiting for module to load');
        };
        window.openCustomTransformGuide = function() {
            window.open('custom-transform-guide.html', '_blank');
        };
        window.toggleNotesPanel = function() {
            console.log('toggleNotesPanel called - waiting for module to load');
        };
    </script>
    
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/tutorial.js"></script>
    <script type="module" src="js/feedbackHandler.js"></script>
</body>

</html>