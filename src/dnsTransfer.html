<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>DNS Transfer Example - Insight Nexus</title>
    <!-- Copyright (c) 2024 Investigating Project - Licensed under the GNU Affero General Public License v3.0 (AGPL-3.0) -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/guide.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600&display=swap" rel="stylesheet">
</head>

<body class="guide-page">
    <button class="back-button" onclick="window.history.back()">‚Üê Back to Guide</button>

    <div class="guide-container">
        <div class="guide-header">
            <h1 class="guide-title">DNS Transfer Example</h1>
            <p class="guide-subtitle">DNS zone transfer attempt with file upload</p>
        </div>

        <div class="guide-section">
            <div class="section-content">
                <div class="code-block">
                    <pre>import sys, json, subprocess, os, time
domain = sys.argv[1]
try:
    # Attempt zone transfer using dig
    result = subprocess.run(['dig', f'@{domain}', 'AXFR', domain], 
                          capture_output=True, text=True, timeout=30)
    
    if result.returncode == 0 and result.stdout:
        # Create zone transfer report
        report = f"DNS Zone Transfer Report for {domain}\n"
        report += "=" * 50 + "\n\n"
        report += f"Command: dig @{domain} AXFR {domain}\n\n"
        report += "Results:\n"
        report += result.stdout
        
        # Return new format with file
        result_data = {
            "nodes": [],  # No new nodes
            "files": [{
                "name": f"zone_transfer_{domain}_{int(time.time())}.txt",
                "content": report,
                "type": "text"
            }]
        }
        print(json.dumps(result_data))
    else:
        # Create failure report file
        failure_report = f"DNS Zone Transfer Report for {domain}\n"
        failure_report += "=" * 50 + "\n\n"
        failure_report += f"Command: dig @{domain} AXFR {domain}\n\n"
        failure_report += "Status: FAILED\n"
        failure_report += f"Return Code: {result.returncode}\n"
        failure_report += f"Error Output: {result.stderr}\n"
        failure_report += f"Standard Output: {result.stdout}\n"
        
        result_data = {
            "nodes": [],  # No new nodes
            "files": [{
                "name": f"zone_transfer_failed_{domain}_{int(time.time())}.txt",
                "content": failure_report,
                "type": "text"
            }]
        }
        print(json.dumps(result_data))
except Exception as e:
    # Create error report file
    error_report = f"DNS Zone Transfer Report for {domain}\n"
    error_report += "=" * 50 + "\n\n"
    error_report += f"Command: dig @{domain} AXFR {domain}\n\n"
    error_report += "Status: ERROR\n"
    error_report += f"Error: {str(e)}\n"
    
    result_data = {
        "nodes": [],  # No new nodes
        "files": [{
            "name": f"zone_transfer_error_{domain}_{int(time.time())}.txt",
            "content": error_report,
            "type": "text"
        }]
    }
    print(json.dumps(result_data))</pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Add dark mode support
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        // Check for existing dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }

        // Save dark mode preference
        document.addEventListener('DOMContentLoaded', function() {
            const darkModeToggle = document.createElement('button');
            darkModeToggle.innerHTML = 'üåô';
            darkModeToggle.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-gradient);
                color: white;
                border: none;
                padding: 12px;
                border-radius: 50%;
                cursor: pointer;
                font-size: 18px;
                z-index: 1000;
                box-shadow: var(--shadow-light);
                transition: var(--transition-smooth);
            `;
            darkModeToggle.onclick = function() {
                toggleDarkMode();
                localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            };
            document.body.appendChild(darkModeToggle);
        });
    </script>
</body>

</html>
